<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing a Simple Robot &mdash; Beneath a Binary Sky</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Beneath a Binary Sky" href="index.html" />
    <link rel="prev" title="API of the World Server" href="api.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api.html" title="API of the World Server"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Beneath a Binary Sky</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="writing-a-simple-robot">
<h1>Writing a Simple Robot<a class="headerlink" href="#writing-a-simple-robot" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we&#8217;re going to write a simple robot for Benath a Binary Sky.
This robot is not intelligent at all! We&#8217;re writing this only to get familiar
with the API of the server. You can find some complete examples in <em>sample_bots</em>
directory.</p>
<div class="section" id="born">
<h2>Born<a class="headerlink" href="#born" title="Permalink to this headline">¶</a></h2>
<p>The first thing a robot should do, is born! By calling <em>born</em> command, the physic
of the robot will be created in the server&#8217;s world.</p>
<p>In order to born, robot needs a password. This is either a pre-defined password, or
a password received from its parent.</p>
<p>Pre-defined passwords are defined in the server
configurations. These will be used when the server is just started, and some new
robots going to join it. Each of these new robots have one of these passwords.
After that, the only way to add new robots to the world is by <em>giving birth</em> to
a child robot. When a robot gains enough honor from the society, it can gives birth
to a new robot. (Honor can obtain by watering plants.) Parent robot will be call
<em>give_birth</em> command, and in response, receives a new password. It&#8217;s child can use
this password to <em>born</em> in the world.</p>
<p>After born, robot will get a <em>robot ID</em> and a new <em>password</em>. (The password used for born
is consumed and can&#8217;t be used again.)</p>
<p>Anyway, let&#8217;s assume that we a have a password in hand. We&#8217;re going to send a <em>born</em> command
to the server.</p>
<p>In Python, we will do this:</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">http.client</span>
<span class="kn">import</span> <span class="nn">msgpack</span>

<span class="c1"># First, we create an HTTPS connection to the server. We assumed</span>
<span class="c1"># that server is listen on localhost and 9537 port.</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9537</span><span class="p">)</span>

<span class="c1"># This our request dictionary.</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;born&quot;</span><span class="p">,</span>
           <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;jhEu23nCod198EnqSx&quot;</span><span class="p">,</span>
           <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="c1"># Now we pack our request with MsgPack, before sending it to the server.</span>
<span class="n">packed_request</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">packb</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1"># Now that our request is ready, we sent it using POST method to ``/msgpack`` URL.</span>
<span class="n">connection</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/msgpack&quot;</span><span class="p">,</span> <span class="n">packed_request</span><span class="p">)</span>

<span class="c1"># Getting response.</span>
<span class="n">http_response</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="n">packed_response</span> <span class="o">=</span> <span class="n">http_response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># Server respond in MsgPack too, so we need to unpack the response</span>
<span class="c1"># before we can use it.</span>
<span class="c1"># We should set the encoding for MsgPack, or else it gives us Bytes</span>
<span class="c1"># instead of Str.</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">unpackb</span><span class="p">(</span><span class="n">packed_response</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="c1"># Before continue, we checked if any errors occurred. If there was any error</span>
<span class="c1"># in executing the command, server would set the *status* code of the response to 500.</span>
<span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Error!&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;error_code&quot;</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;error_message&quot;</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># there&#39;s a &quot;result&quot; key in the response, which contains the ID and Password</span>
<span class="c1"># of the newly borned robot.</span>
<span class="n">robot_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;robot_id&quot;</span><span class="p">]</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;New Robot ID:&quot;</span><span class="p">,</span> <span class="n">robot_id</span><span class="p">,</span> <span class="s2">&quot;New Password:&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: We used MsgPack because it&#8217;s more efficient than JOSN, both in message size and its performance.</p>
</div>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Now, we&#8217;re going to send <em>status</em> command to the server to obtain status of our robot.</p>
<p>Following our Python example, add these lines to the previous code:</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="c1"># New request dictionary. Note that from now on, we should use the</span>
<span class="c1"># ID and the Password that was received from the server before.</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span>
           <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
           <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">robot_id</span><span class="p">]}</span>

<span class="c1"># Packing the request.</span>
<span class="n">packed_request</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">packb</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1"># Sending message using POST method.</span>
<span class="n">connection</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/msgpack&quot;</span><span class="p">,</span> <span class="n">packed_request</span><span class="p">)</span>
<span class="n">http_response</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="n">packed_response</span> <span class="o">=</span> <span class="n">http_response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># Unpacking the response as before.</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">unpackb</span><span class="p">(</span><span class="n">packed_response</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="c1"># Checking for any error.</span>
<span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Error!&quot;</span><span class="p">,</span> <span class="n">reponse</span><span class="p">[</span><span class="s2">&quot;error_code&quot;</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;error_message&quot;</span><span class="p">])</span>

<span class="c1"># The result is a dictionary which contains status of our robot.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;My current location is&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span> <span class="s2">&quot;, and I have&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="s2">&quot;units of energy.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>So simple!</p>
<p>For a complete list of available commands, and error codes, see <a class="reference internal" href="api.html"><span class="doc">API of the World Server</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Beneath a Binary Sky</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=aidin36&repo=beneath-a-binary-sky&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install and run</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing a Simple Robot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#born">Born</a></li>
<li class="toctree-l2"><a class="reference internal" href="#status">Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API of the World Server</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Aidin Gharibnavaz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>